# Sql-ex

#### Ник:  VadimKulkov

### Select(рейтинговые этапы)

Краткая информация о базе данных <b>"Компьютерная фирма"</b>:

Схема БД состоит из четырех таблиц:
Product(maker, model, type)
PC(code, model, speed, ram, hd, cd, price)
Laptop(code, model, speed, ram, hd, price, screen)
Printer(code, model, color, type, price)

Таблица Product представляет производителя (maker), номер модели (model)
и тип ('PC' - ПК, 'Laptop' - ПК-блокнот или 'Printer' - принтер).

Предполагается, что номера моделей в таблице Product уникальны для всех производителей и типов продуктов. В таблице PC
для каждого ПК, однозначно определяемого уникальным кодом – code, указаны модель – model (внешний ключ к таблице
Product), скорость - speed (процессора в мегагерцах), объем памяти - ram (в мегабайтах), размер диска - hd (в
гигабайтах), скорость считывающего устройства - cd (например, '4x') и цена - price (в долларах).

Таблица Laptop аналогична таблице РС за исключением того, что вместо скорости CD содержит размер экрана -screen (в
дюймах).

В таблице Printer для каждой модели принтера указывается, является ли он цветным - color ('y', если цветной), тип
принтера - type (лазерный – 'Laser', струйный – 'Jet' или матричный – 'Matrix') и цена - price.

### Задание 1

Дима и Миша пользуются продуктами от одного и того же производителя. Тип Таниного принтера не такой, как у Вити, но
признак "цветной или нет" - совпадает. Размер экрана Диминого ноутбука на 3 дюйма больше Олиного. Мишин ПК в 4 раза
дороже Таниного принтера. Номера моделей Витиного принтера и Олиного ноутбука отличаются только третьим символом. У
Костиного ПК скорость процессора, как у Мишиного ПК; объем жесткого диска, как у Диминого ноутбука; объем памяти, как у
Олиного ноутбука, а цена - как у Витиного принтера. Вывести все возможные номера моделей Костиного ПК.

[Решение 1 задания](solutions/1.sql)

### Задание 2

Рассматривается <b>БД кораблей</b>, участвовавших во второй мировой войне. Имеются следующие отношения:
Classes (class, type, country, numGuns, bore, displacement)
Ships (name, class, launched)
Battles (name, date)
Outcomes (ship, battle, result)
Корабли в «классах» построены по одному и тому же проекту, и классу присваивается либо имя первого корабля, построенного
по данному проекту, либо названию класса дается имя проекта, которое не совпадает ни с одним из кораблей в БД. Корабль,
давший название классу, называется головным. Отношение Classes содержит имя класса, тип (bb для боевого (линейного)
корабля или bc для боевого крейсера), страну, в которой построен корабль, число главных орудий, калибр орудий (диаметр
ствола орудия в дюймах) и водоизмещение ( вес в тоннах). В отношении Ships записаны название корабля, имя его класса и
год спуска на воду. В отношение Battles включены название и дата битвы, в которой участвовали корабли, а в отношении
Outcomes – результат участия данного корабля в битве (потоплен-sunk, поврежден - damaged или невредим - OK). Замечания.
В отношение Outcomes могут входить корабли, отсутствующие в отношении Ships. 2) Потопленный корабль в последующих битвах
участия не принимает.

Для каждого месяца (с учетом года) из таблицы Battles посчитать сколько раз повторяется каждый день недели в этом
месяце. Вывод: месяц (в формате "YYYY-ММ"), количество понедельников, вторников, ...воскресений.

[Решения 2 задания](solutions/2.sql)

### Задание 3

<b> База данных - "Компьютерная фирма" </b> <br>
Для таблицы Product получить результирующий набор в виде таблицы со столбцами maker, pc, laptop и printer, 
в которой для каждого производителя требуется указать, производит он (yes) или нет (no) соответствующий тип продукции.
В первом случае (yes) указать в скобках без пробела количество имеющихся в наличии 
(т.е. находящихся в таблицах PC, Laptop и Printer) различных по номерам моделей соответствующего типа.

[Решение 3 задания(не проходит на тестовой базе)](solutions/3.sql)

### Задание 4

<b> База данных - "Компьютерная фирма" </b> <br>

Посчитать сумму цифр в номере каждой модели из таблицы Product
Вывод: номер модели, сумма цифр

[Решение 4 задания](solutions/4.sql)

### Задание 5
<b>Краткая информация о базе данных "Фирма вторсырья":</b> <br>
Фирма имеет несколько пунктов приема вторсырья. Каждый пункт получает деньги для их выдачи сдатчикам вторсырья. Сведения о получении денег на пунктах приема записываются в таблицу:
Income_o(point, date, inc)
Первичным ключом является (point, date). При этом в столбец date записывается только дата (без времени), т.е. прием денег (inc) на каждом пункте производится не чаще одного раза в день. Сведения о выдаче денег сдатчикам вторсырья записываются в таблицу:
Outcome_o(point, date, out)
В этой таблице также первичный ключ (point, date) гарантирует отчетность каждого пункта о выданных деньгах (out) не чаще одного раза в день.
В случае, когда приход и расход денег может фиксироваться несколько раз в день, используется другая схема с таблицами, имеющими первичный ключ code:
Income(code, point, date, inc)
Outcome(code, point, date, out)
Здесь также значения столбца date не содержат времени.

Вывести все записи из Outcome и Income, даты которых отстоят не менее чем на 2 календарных месяца от максимальной даты в обеих таблицах (т.е. при максимальной дате 2009-12-05 последняя выводимая дата должна быть меньше 2009-10-01).
Выполнить помесячное разбиение этих записей, присвоив порядковый номер каждому месяцу (с учётом года), попавшему в выборку.
Вывод: порядковый номер месяца, первый день месяца в формате "yyyy-mm-dd", последний день месяца в формате "yyyy-mm-dd", код записи, пункт, дата, сумма (для таблицы Outcome должна быть отрицательной)

[Решение задания 5](solutions/5.sql)

### Задание -2 (6)
<b>БД кораблей</b>

Для каждой страны определить год, когда на воду было спущено максимальное количество ее кораблей. В случае, если окажется несколько таких лет, взять минимальный из них.
Вывод: страна, количество кораблей, год
Замечание. Учитывать только корабли с известным годом спуска на воду.

[Решение задания -2](solutions/6.sql)

### Задание -4 (7)
Схема базы данных состоит из трех отношений:
utQ (Q_ID int, Q_NAME varchar(35)); utV (V_ID int, V_NAME varchar(35), V_COLOR char(1)); utB (B_DATETIME datetime, B_Q_ID int, B_V_ID int, B_VOL tinyint).
Таблица utQ содержит идентификатор и название квадрата, цвет которого первоначально черный.
Таблица utV содержит идентификатор, название и цвет баллончика с краской.
Таблица utB содержит информацию об окраске квадрата баллончиком: время окраски, идентификатор квадрата, идентификатор баллончика, количество краски.
При этом следует иметь в виду, что:
- баллончики с краской могут быть трех цветов - красный V_COLOR='R', зеленый V_COLOR='G', голубой V_COLOR='B' (латинские буквы).
- объем баллончика равен 255 и первоначально он полный;
- цвет квадрата определяется по правилу RGB, т.е. R=0,G=0,B=0 - черный, R=255, G=255, B=255 - белый;
- запись в таблице закрасок utB уменьшает количество краски в баллончике на величину B_VOL и соответственно увеличивает количество краски в квадрате на эту же величину;
- значение 0 < B_VOL <= 255;
- количество краски одного цвета в квадрате не превышает 255, а количество краски в баллончике не может быть меньше нуля;
- время окраски B_DATETIME дано с точностью до секунды, т.е. не содержит миллисекунд.

Найти квадраты, время между первой и последней окраской которых превышает среднее время по всем окрашенным квадратам.
Вывести название квадрата и наибольшее время между двумя его последовательными окрасками в секундах.
[Решение задания -4](solutions/8.sql)

### Задание -3 (8)
База данных - Окраска

На планете Торус 6x4 живут торусианцы трёх цветов (красные, зелёные и синие).
Первые 24 квадрата таблицы utQ, отсортированные по Q_ID - страны планеты: <br>
Т00 - первый квадрат <br>
Т03 - четвёртый квадрат <br>
Т10 - пятый квадрат<br>
T53 - двадцать четвертый квадрат <br>
Количество краски на квадрате - численность торусианцев соответствующего цвета в стране (R, G, B).
В день рождения Меркадота все торусианцы в каждой стране разбиваются на группы - 8 групп каждого цвета; численность каждой группы определяется как R/8, G/8, B/8 - и направляются в 8 соседних стран (по одной группе каждого цвета на страну).
Не попавшие в группы торусианцы в количестве R%8, G%8, B%8 остаются дома.
Найти количество торусианцев каждого цвета в каждой стране в этот знаменательный день.
Вывести на карте Меркадота для страны "Т00" количество торусианцев каждого цвета в странах Txy (x - номер строки, y - номер столбца) в формате "Txy - cccR cccG cccB", где Txy - название страны, ccc - количество с ведущими нулями.

[Решение задания -3](solutions/8.sql) 

